---
title: "Assignment 2"
author: "Taylor Gries"
date: '2022-04-20'
output: html_document
---

# Overview 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(janitor)
library(broom)
library(equatiomatic)
```

### Notes:

- Current (i.e. baseline) water use in these districts 1 is: Kern = 150 AF, Mojave = 140 AF, Antelope = 220 AF, and Ventura = 245 AF.

- Prices are in $/Acre Foot and quantities are in Acre Feet (AF).

```{r}
# read in the data
water <- read_csv(here("data", "Water_Districts.csv")) %>% 
  clean_names()
  
```

```{r}
water_clean <- water %>% 
  pivot_longer(cols = c(3:6), names_to = "district", values_to = "mc") %>% 
  mutate(district = case_when(
    district == "mc_kern" ~ "Kern", 
    district == "mc_antelope" ~ "Antelope", 
    district == "mc_ventura" ~ "Ventura", 
    district == "mc_mojave" ~ "Mojave"
  ))
```

# Part 1

For each irrigation district, plot the marginal abatement cost data (from the data provided) and
estimate a linear regression model with zero intercept. These estimated linear regressions will be your
estimates of the marginal abatement cost curve (one for each irrigation district), which you will use for
the remainder of this analysis.

- Reduction = Abatement
- MC = Marginal Cost of Abatement

```{r}
ggplot(data = water_clean, 
       aes(x = reduction, y = mc, color = district)) +
  geom_line() + 
  geom_smooth(method = "lm") +
  theme_minimal() +
  labs(y = "Marginal Cost of Abatement ($/AF)", 
       x = "Reduction (AF)",
       color = "District Name")
```
**Figure 1**: 

# Part 2

```{r}
# Define linear regression models forcing 0 intercept

# linear regression
lm_kern <- lm(mc_kern ~ 0 + reduction, data = water) # get equation P = 2.29A 
lm_ventura <- lm(mc_ventura ~ 0 + reduction, data = water) # get equation P = 1.78(A) 
lm_antelope <- lm(mc_antelope ~ 0 + reduction, data = water) # get equation P = 3.8(A) 
lm_mojave <- lm(mc_mojave ~ 0 + reduction, data = water) # get equation P = 2.86(A) 


# Find slopes
kern_slope <- lm_kern$coefficient[1]
mojave_slope <- lm_mojave$coefficient[1]
antelope_slope <- lm_antelope$coefficient[1]
ventura_slope <- lm_ventura$coefficient[1]

# Predict by multiplying a vector of abatement number by the slope
kern_predict <- predict(lm_kern)
ventura_predict <- predict(lm_ventura)
antelope_predict <- predict(lm_antelope)
mojave_predict <- predict(lm_mojave)

# Create data set

mc_predict <- data.frame(water, kern_predict, mojave_predict, antelope_predict, ventura_predict) 

mc_predict_df <- mc_predict %>% 
  select(reduction, kern_predict, mojave_predict, antelope_predict, ventura_predict) %>% 
  rename(Kern = kern_predict,
         Mojave = mojave_predict,
         Antelope = antelope_predict,
         Ventura = ventura_predict) %>% 
  pivot_longer(cols = c(Kern, Mojave, Antelope, Ventura),
               names_to = 'district',
               values_to = 'mc_predict')

# Generate demand by substituting Abatement = Baseline - Use 

# MC = Slope * Abatement

# Abatement (Reduction) = Baseline Use - Current Use

# Kern Baseline = 150 

kern_bl <- 150
kern_data <- mc_predict_df %>%
  filter(district %in% "Kern") %>%
  mutate(demand = kern_bl - reduction)

ggplot(kern_data, aes(x = demand, y = mc_predict)) +
  geom_line() + 
  labs(x = 'Water Demand (AF)', y = '$/AF')

# Ventura Baseline = 245
ventura_bl <- 245
ventura_data <- mc_predict_df %>%
  filter(district %in% "Ventura") %>%
  mutate(demand = ventura_bl - reduction)

ggplot(ventura_data, aes(x = demand, y = mc_predict)) +
  geom_line() + 
  labs(x = 'Water Demand (AF)', y = '$/AF')

# Mojave Baseline = 140 
mojave_bl <- 140
mojave_data <- mc_predict_df %>%
  filter(district %in% "Mojave") %>%
  mutate(demand = mojave_bl - reduction)

ggplot(mojave_data, aes(x = demand, y = mc_predict)) +
  geom_line() + 
  labs(x = 'Water Demand (AF)', y = '$/AF')


# Antelope Baseline = 220 
antelope_bl <- 220
antelope_data <- mc_predict_df %>%
  filter(district %in% "Antelope") %>%
  mutate(demand = mojave_bl - reduction)

ggplot(antelope_data, aes(x = demand, y = mc_predict)) +
  geom_line() + 
  labs(x = 'Water Demand (AF)', y = '$/AF')
```

```{r}


```


# Part 2

Using your estimated marginal abatement cost curves, derive each district’s demand curve for water.
In other words, how much would each district be willing to pay for the right to use the first AF of water,
second AF, etc.? Plot each district’s demand curve on a single graph. Which sector is willing to pay the
most for the first AF of water?




# Part 3

Here you will analyze three alternative policies for reducing water use among these irrigation districts.
In total, these irrigation districts will need to reduce water consumption from the current 755 AF down
to 500 AF. For each intervention listed below, perform the following calculations: (1) calculate the
stringency of the policy (defined below for each intervention) required to achieve the 500 AF target, (2)
calculate the total cost of meeting the target using that approach, (3) calculate the cost to each district,
and (4) calculate the tax revenue generated.

## A. 

**Cap without trade.** Reduce each district’s water use by the same fraction (e.g., 1/3 of current
baseline use), so the 500 AF target is met. Trade is not allowed. Stringency is defined as the
magnitude of the fraction.


## B. 

**Tax on water use.** A single tax is implemented on all water use in each of the four districts, such
that water use is reduced to the 500 AF target. Stringency is defined as the magnitude of the
tax.

## C.

**Cap and trade.** Cap water use as in part (a), but after those caps are set, allow trade across
districts. How much water is used by each district after trade? Stringency is the same as in part
(a).


# Part 4

A severe drought hits California, and it is necessary to reduce water use from 500 AF down to 300 AF. Your
job is to estimate the cost of the drought (i.e., the cost of reducing water use from 500 AF to 300 AF) to
each irrigation district under each policy. Considering the entire jump from status quo (755 AF) to the
drought (300 AF), which policy is preferred by each irrigation district? How does your answer depend on
how rights are allocated to each district (in policies (a) and (c))2? 
